<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Доставка и оплата | Ёжкин ролл</title>

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@600;700;800&display=swap"
        rel="stylesheet">

    <!-- Yandex Maps API v2.1 -->
    <script
        src="https://api-maps.yandex.ru/2.1/?apikey=76c6dafd-ce2d-4895-a10b-e98de9678cf8&lang=ru_RU&coordorder=longlat"
        type="text/javascript"></script>

    <!-- DaData Suggestions (for address search) -->
    <link href="https://cdn.jsdelivr.net/npm/suggestions-jquery@21.12.0/dist/css/suggestions.min.css"
        rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/suggestions-jquery@21.12.0/dist/js/jquery.suggestions.min.js"></script>

    <style>
        :root {
            --primary: #ff7a00;
            --primary-hover: #e66e00;
            --glass: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.5);
            --text-dark: #1f2937;
            --text-muted: #6b7280;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f3f4f6;
            color: var(--text-dark);
            overflow-x: hidden;
        }

        /* Nova Glass Background */
        .page-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #fff5eb 0%, #ffffff 100%);
            z-index: -1;
        }

        .header {
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 100;
        }

        .logo {
            font-family: 'Outfit', sans-serif;
            font-weight: 800;
            font-size: 24px;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 40px 60px;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            height: calc(100vh - 120px);
            min-height: 600px;
        }

        @media (max-width: 1100px) {
            .main-container {
                grid-template-columns: 1fr;
                height: auto;
            }
        }

        /* Map Styling */
        .map-section {
            position: relative;
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        #map {
            width: 100%;
            height: 100%;
            border-top-left-radius: 0;
            /* Map takes full space */
        }

        /* Search Overlay */
        .search-box {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            z-index: 10;
            display: flex;
            gap: 10px;
        }

        .search-box input {
            flex: 1;
            padding: 12px 20px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
            outline: none;
            transition: 0.2s;
        }

        .search-box input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 122, 0, 0.1);
        }

        /* DaData Styling Overrides */
        .suggestions-wrapper {
            position: absolute !important;
            width: 100%;
        }

        .suggestions-suggestions {
            border-radius: 12px !important;
            border: 1px solid #eee !important;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1) !important;
            overflow: hidden;
            font-family: 'Inter', sans-serif !important;
        }

        /* Info Sidebar */
        .info-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 25px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.04);
        }

        .card-title {
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title svg {
            color: var(--primary);
        }

        .price-badge {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            margin-top: 10px;
        }

        .price-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary);
            display: block;
        }

        .price-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .delivery-info-list {
            list-style: none;
            margin-top: 15px;
        }

        .delivery-info-list li {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
            font-size: 14px;
            color: var(--text-dark);
            line-height: 1.4;
        }

        .icon-check {
            color: #10b981;
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* Active Zone Info */
        #active-zone-info {
            display: none;
        }

        #active-zone-info.visible {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .footer-note {
            font-size: 12px;
            color: var(--text-muted);
            text-align: center;
            margin-top: 20px;
        }

        /* Map Tooltip Mockup */
        .ymaps-2-1-79-balloon__content {
            padding: 15px !important;
            border-radius: 15px !important;
            font-family: 'Inter', sans-serif !important;
        }

        .pickup-badge {
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            font-size: 13px;
            font-weight: 600;
            color: #333;
        }
    </style>
</head>

<body>
    <div class="page-bg"></div>

    <!-- Header removed as requested, using Tilda global header -->

    <main class="main-container">
        <!-- Map Section -->
        <section class="map-section">
            <div class="search-box">
                <input type="text" id="address-input" placeholder="Введите ваш адрес для проверки доставки...">
                <button id="search-btn"
                    style="background: var(--primary); color: #fff; border: none; padding: 0 25px; border-radius: 10px; font-weight: 600; cursor: pointer;">Проверить</button>
            </div>
            <div id="map"></div>
        </section>

        <!-- Sidebar Section -->
        <aside class="info-sidebar">
            <!-- Pickup Locations -->
            <div class="glass-card">
                <div class="card-title">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                        </path>
                    </svg>
                    Самовывоз (наши филиалы)
                </div>
                <div style="display: flex; flex-direction: column; gap: 10px; font-size: 13px;">
                    <a href="https://yandex.ru/profile/-/CLhp7KIY" target="_blank"
                        style="text-decoration: none; color: inherit; padding: 12px; border-radius: 12px; background: rgba(255,122,0,0.05); border-left: 3px solid var(--primary); transition: 0.2s; display: block;">
                        <b style="color: var(--primary);">Адлер:</b> ул. Голубые Дали, 58/3
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">Смотреть на картах →
                        </div>
                    </a>
                    <a href="https://yandex.ru/profile/-/CLhtAY1F" target="_blank"
                        style="text-decoration: none; color: inherit; padding: 12px; border-radius: 12px; background: rgba(255,122,0,0.05); border-left: 3px solid var(--primary); transition: 0.2s; display: block;">
                        <b style="color: var(--primary);">Сочи (Центр):</b> ул. Воровского, 5
                        <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">Смотреть на картах →
                        </div>
                    </a>
                </div>
                <p style="font-size: 12px; color: var(--text-muted); margin-top: 15px; line-height: 1.4;">
                    Вы можете бесплатно забрать заказ из наших кафе.
                </p>
            </div>

            <!-- Dynamic Zone Card -->
            <div id="active-zone-info" class="glass-card">
                <div class="card-title">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z">
                        </path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    Ваша зона доставки
                </div>
                <div id="zone-details">
                    <!-- Dynamic Content -->
                </div>
            </div>

            <!-- Delivery Rules Card -->
            <div class="glass-card">
                <div class="card-title">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Важные условия
                </div>
                <ul class="delivery-info-list" style="font-size: 13px;">
                    <li style="margin-bottom: 8px;">
                        • Время доставки уточняет оператор при подтверждении заказа.
                    </li>
                    <li style="margin-bottom: 8px;">
                        • <b>За пределами зон:</b> доставка от 2000 ₽, по полной предоплате + компенсация 50% стоимости
                        такси.
                    </li>
                    <li style="margin-bottom: 8px;">
                        • Мы прилагаем все усилия для сохранения температуры блюд, но не гарантируем, что горячие блюда
                        останутся идеально горячими к моменту доставки.
                    </li>
                    <li style="margin-bottom: 8px; color: var(--text-dark);">
                        • При заказе уточните количество приборов. Имбирь, васаби и соевый соус приобретаются
                        дополнительно.
                    </li>
                </ul>
            </div>

            <!-- Zones Summary Card -->
            <div class="glass-card">
                <div class="card-title">Зоны доставки</div>
                <div style="display: grid; gap: 8px; font-size: 13px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid rgba(0,0,0,0.05);">
                        <span><span style="color: #ed4543;">●</span> Красная</span>
                        <b>200 ₽ (от 1000 ₽)</b>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid rgba(0,0,0,0.05);">
                        <span><span style="color: #82cdff;">●</span> Голубая</span>
                        <b>300 ₽ (от 1500 ₽)</b>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; padding: 6px 0; border-bottom: 1px solid rgba(0,0,0,0.05);">
                        <span><span style="color: #ff931e;">●</span> Оранжевая</span>
                        <b>400 ₽ (от 2000 ₽)</b>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px 0;">
                        <span><span style="color: #0e4779;">●</span> Синяя</span>
                        <b>450 ₽ (от 2500 ₽)</b>
                    </div>
                </div>
            </div>

            <!-- Shop Info -->
            <div class="glass-card">
                <div class="card-title">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Режим работы
                </div>
                <p style="font-size: 14px; color: var(--text-dark)">Ежедневно с 11:00 до 23:00</p>
                <p style="font-size: 13px; color: var(--text-muted); margin-top: 8px;">Заказы на доставку принимаются до
                    <b>22:30</b>
                </p>
            </div>
        </aside>
    </main>

    <script>
        ymaps.ready(init);

        function init() {
            var myMap = new ymaps.Map("map", {
                center: [39.92, 43.43], // Сириус/Адлер (Lon, Lat)
                zoom: 12,
                controls: ['zoomControl', 'fullscreenControl']
            }, {
                // Темный монохромный стиль через фильтры (нативная поддержка в API 2.1 ограничена, используем слой)
                yandexMapDarkness: 0.8
            });

            // Применяем кастомный стиль (Черно-белый / Темный)
            myMap.panes.get('ground').getElement().style.filter = 'grayscale(100%) invert(100%) brightness(90%) contrast(90%)';
            // Возвращаем цвет только для наших зон и маркеров (они в другом слое)
            myMap.panes.get('areas').getElement().style.filter = 'none';
            myMap.panes.get('overlap').getElement().style.filter = 'none';

            // Вшитые данные зон ( GeoJSON )
            const GEO_DATA = { "type": "FeatureCollection", "metadata": { "name": "Доставка Ёжкин ролл", "creator": "Yandex Map Constructor", "description": "\n" }, "features": [{ "type": "Feature", "id": 0, "geometry": { "type": "Polygon", "coordinates": [[[39.92538724071251, 43.41872972889517], [39.92341606092539, 43.41476402631541], [39.92504684400643, 43.414263472872214], [39.92710678052987, 43.41338749432036], [39.9328574366578, 43.41019632168377], [39.93792144727793, 43.40669209393007], [39.950967711926396, 43.398243562639585], [39.96023742628186, 43.39818097649941], [39.972682876110966, 43.393173874349536], [39.99311057996838, 43.38522424393602], [40.007439827452934, 43.384190998715916], [40.00855717784621, 43.39563888792172], [40.009415484730965, 43.405464529819234], [40.013792849843284, 43.412472924196436], [40.01508031017043, 43.42091945695046], [40.011732913319875, 43.424047501252865], [40.00726971751911, 43.42529867341827], [40.00237736827593, 43.423984941960974], [39.99422345287067, 43.424110060479634], [39.994137622182194, 43.42141995491343], [39.99104771739703, 43.41866716416368], [39.98812947398884, 43.423922382580386], [39.973881579701725, 43.42886437118974], [39.97079167491661, 43.426487262782665], [39.95585713512168, 43.42542378910807], [39.96057782298789, 43.42911458758259], [39.94941983348593, 43.43499437459537], [39.9488190186666, 43.43411869809606], [39.93148121959434, 43.42730049459631], [39.92538724071251, 43.41872972889517]]] }, "properties": { "description": "Доставка 400р фиксированно\nМинимальная сумма заказа 1000р", "fill": "#ed4543", "fill-opacity": 0.6, "stroke": "#ed4543", "stroke-width": "5", "stroke-opacity": 0.9 } }, { "type": "Feature", "id": 1, "geometry": { "type": "Polygon", "coordinates": [[[39.92320659467596, 43.41603938256687], [39.926639822215016, 43.42323422523829], [39.931188848704274, 43.42817627042529], [39.94166019269839, 43.43192945099449], [39.94552257367982, 43.4336183057718], [39.951702383250144, 43.43981036721358], [39.95813968488589, 43.453130517813186], [39.956938055247214, 43.45550657220519], [39.95298984357729, 43.456194359876974], [39.94792583295717, 43.45832019923559], [39.94329097577943, 43.45706971461055], [39.94753959485894, 43.46704160521099], [39.9217045576275, 43.478730677779936], [39.912349012583505, 43.4986031238916], [39.898186948984886, 43.49647871131736], [39.8875439436138, 43.493166976892404], [39.884110716074716, 43.492417124836166], [39.89585787584605, 43.462628038510296], [39.90452677538218, 43.4329866737935], [39.92320659467596, 43.41603938256687]]] }, "properties": { "description": "Доставка 400р фиксированно\nМинимальная сумма заказа 1000р", "fill": "#ed4543", "fill-opacity": 0.6, "stroke": "#ed4543", "stroke-width": "5", "stroke-opacity": 0.9 } }, { "type": "Feature", "id": 2, "geometry": { "type": "Polygon", "coordinates": [[[39.708895699419855, 43.58143874290238], [39.70820905391204, 43.578942881731855], [39.71198560420502, 43.578942881731855], [39.71438886348235, 43.580066032152395], [39.71610547725189, 43.58293620959231], [39.722971932330005, 43.576446916369136], [39.731040017046816, 43.56870876160697], [39.73395826045501, 43.57083061335207], [39.74151136104096, 43.585681467770286], [39.74803449336518, 43.595288878560616], [39.7471761864804, 43.60501948628281], [39.73962308589447, 43.60614214673125], [39.73275663081633, 43.608636872185784], [39.730181710162036, 43.61025838785614], [39.72262860957611, 43.60901107201707], [39.71438886348235, 43.60389680473481], [39.70941068355072, 43.602025621933485], [39.71078397456635, 43.59167068436528], [39.713358895220644, 43.58530712180614], [39.71438886348235, 43.58281142213414], [39.708895699419855, 43.58143874290238]]] }, "properties": { "description": "Доставка 200р фиксированно\nМинимальная сумма заказа 1000р", "fill": "#ed4543", "fill-opacity": 0.6, "stroke": "#ed4543", "stroke-width": "5", "stroke-opacity": 0.9 } }, { "type": "Feature", "id": 3, "geometry": { "type": "Polygon", "coordinates": [[[39.70941068355072, 43.59379172132514], [39.710440651812426, 43.59216975868103], [39.7090673607968, 43.60215036930016], [39.71507550899016, 43.60464526146772], [39.72245694819917, 43.60913580479634], [39.73035337153901, 43.610507847921234], [39.73687650386323, 43.607140049439735], [39.74700452510345, 43.605019486305984], [39.74786283198821, 43.59553840114289], [39.74408628169526, 43.59004866415403], [39.733786599078066, 43.57083061337525], [39.730525032915956, 43.56883357852252], [39.73412992183196, 43.56771021711415], [39.74786283198821, 43.56309173188109], [39.76374150935637, 43.554727621432235], [39.77584363643158, 43.5588474040533], [39.77627278987395, 43.56771021716062], [39.772925393023364, 43.57557330392326], [39.767260567583925, 43.581563533249025], [39.76554395381439, 43.587303606547934], [39.76382734004487, 43.596162202982164], [39.76451398555268, 43.60177612648818], [39.76468564692963, 43.60514422739777], [39.76348401729095, 43.62235599967288], [39.760737435259706, 43.62734399182385], [39.74889280024994, 43.631583457448215], [39.73395826045501, 43.634575840112284], [39.72262860957611, 43.63420180048494], [39.71524717036713, 43.631708143054944], [39.706835762896425, 43.62983783160185], [39.699625985064394, 43.62659581957174], [39.698767678179635, 43.62347833424592], [39.70151426021088, 43.61587098677417], [39.707350747027284, 43.6007781341716], [39.70941068355072, 43.59379172132514]]] }, "properties": { "description": "Доставка 300р фиксированно\nМинимальная сумма заказа 1500р", "fill": "#82cdff", "fill-opacity": 0.6, "stroke": "#82cdff", "stroke-width": "5", "stroke-opacity": 0.9 } }, { "type": "Feature", "id": 4, "geometry": { "type": "Polygon", "coordinates": [[[39.79438306514251, 43.54249144347735], [39.80330945674409, 43.53874517461131], [39.80416776362885, 43.54161733504291], [39.79970456782806, 43.54811040723594], [39.79936124507417, 43.557349334120474], [39.80519773189055, 43.56508895849083], [39.80777265254485, 43.574200458528125], [39.8076009911679, 43.58206269198441], [39.80073453608979, 43.58331057047341], [39.797043816485285, 43.57757011376878], [39.79249478999603, 43.57376363749042], [39.789361969866626, 43.57675891783013], [39.78434087459076, 43.57775731126866], [39.78228093806733, 43.5870852443492], [39.77185250941737, 43.598938042291486], [39.76623059932217, 43.60149544293329], [39.76623059932217, 43.61122503985344], [39.76876260463221, 43.6170246224427], [39.76756097499351, 43.620423040831], [39.768118874468556, 43.627312818352245], [39.76485730830642, 43.63526157354791], [39.756960884966574, 43.64003031848458], [39.748779327847025, 43.639929676763096], [39.74302867171909, 43.638558309719556], [39.740711243130235, 43.635441449214056], [39.725090057827494, 43.63886998681544], [39.71891024825717, 43.64042834787303], [39.7118721318021, 43.64105168089919], [39.705348999477884, 43.64204900019501], [39.70191577193883, 43.641425677611906], [39.70071414230015, 43.638059623002675], [39.69762423751499, 43.63195037218099], [39.696519971630934, 43.626043999216975], [39.69549000336923, 43.625233461201525], [39.69967592817205, 43.62149530137351], [39.69907511335271, 43.62517403896685], [39.70010508161442, 43.62673275770268], [39.70740069013492, 43.630099451262566], [39.71967447858707, 43.633216590791335], [39.723107706126136, 43.63433872116555], [39.73915804487127, 43.63346595492019], [39.74877108198063, 43.6316580413783], [39.76113070112125, 43.6272315391018], [39.763533960398554, 43.62218118492019], [39.76439226728331, 43.613139360344725], [39.76439226728329, 43.60035375486037], [39.763533960398426, 43.59580017117607], [39.76765383344532, 43.58138859913586], [39.77306116681934, 43.57527354906811], [39.776408563669875, 43.567847290357925], [39.77572191816206, 43.55879724131907], [39.763533960398405, 43.55455260880181], [39.77658022504684, 43.548060235477514], [39.79438306514251, 43.54249144347735]]] }, "properties": { "description": "Доставка 400р фиксированно\nМинимальная сумма заказа 2000р", "fill": "#ff931e", "fill-opacity": 0.6, "stroke": "#ff931e", "stroke-width": "5", "stroke-opacity": 0.9 } }, { "type": "Feature", "id": 5, "geometry": { "type": "Polygon", "coordinates": [[[39.68108655635341, 43.6378174187896], [39.689154641070246, 43.63164580042245], [39.69421865169032, 43.62572294023005], [39.69490529719818, 43.62516179668114], [39.69636441890223, 43.62597233566969], [39.697566048540956, 43.63264327694036], [39.70005513850668, 43.63675769137272], [39.70151426021083, 43.64099648827512], [39.705204979815356, 43.642430130846606], [39.709324852862245, 43.64585826686735], [39.70872403804291, 43.653461792698046], [39.71224309627041, 43.65377339193165], [39.7080373925351, 43.65564295314228], [39.70460416499602, 43.65352411267503], [39.69207288447844, 43.64635688839936], [39.691557900347604, 43.64024848714723], [39.68726636592376, 43.64087182205253], [39.684694891158685, 43.63967614149978], [39.68108655635341, 43.6378174187896]]] }, "properties": { "description": "Доставка 450р фиксированно\nМинимальная сумма заказа 2500р", "fill": "#0e4779", "fill-opacity": 0.6, "stroke": "#0e4779", "stroke-width": "5", "stroke-opacity": 0.9 } }, { "type": "Feature", "id": 6, "geometry": { "type": "Polygon", "coordinates": [[[39.75730765360985, 43.651082248771765], [39.75181448954736, 43.653512776594326], [39.744690542403745, 43.655133073490575], [39.73996985453754, 43.65089528103624], [39.73928320902973, 43.648402321273515], [39.73636496562154, 43.64460035701588], [39.731730108443806, 43.6411721487058], [39.73095763224752, 43.637806079792725], [39.740656500045354, 43.63543725079341], [39.74297392863423, 43.63855411151822], [39.7485529233852, 43.64029948240777], [39.756706838790485, 43.64011248082608], [39.764860754195745, 43.635374911918234], [39.76829398173481, 43.627394998228255], [39.76795065898091, 43.62334228983959], [39.77189887065083, 43.62309288341178], [39.77661955851704, 43.625399853110956], [39.78185523051411, 43.62583629680875], [39.786575918380315, 43.628205506915855], [39.77378714579732, 43.636309988230884], [39.77421629923966, 43.63948913803342], [39.765633230392005, 43.64335375865216], [39.76074088114883, 43.64534830360381], [39.75730765360985, 43.651082248771765]]] }, "properties": { "description": "Доставка 450р фиксированно\nМинимальная сумма заказа 2500р", "fill": "#0e4779", "fill-opacity": 0.6, "stroke": "#0e4779", "stroke-width": "5", "stroke-opacity": 0.9 } }, { "type": "Feature", "id": 7, "geometry": { "type": "Polygon", "coordinates": [[[39.80769026774545, 43.57443871828299], [39.805357331604405, 43.565700320262955], [39.79943501409952, 43.55758625546678], [39.79960667547647, 43.54822250552535], [39.80415570196573, 43.54172944549238], [39.80269658026163, 43.53835777114735], [39.80741726812784, 43.53679674649965], [39.80734694499153, 43.54023235299647], [39.809149389449544, 43.55821185891596], [39.8213373472132, 43.57549955191968], [39.81507170695443, 43.57836994857789], [39.81052268046516, 43.57774596102597], [39.80769026774545, 43.57443871828299]]] }, "properties": { "description": "Доставка 450р фиксированно\nМинимальная сумма заказа 2500р", "fill": "#0e4779", "fill-opacity": 0.6, "stroke": "#0e4779", "stroke-width": "5", "stroke-opacity": 0.9 } }] };

            var deliveryZones = ymaps.geoQuery(GEO_DATA).addToMap(myMap);

            // Авто-скалирование карты по границам зон
            myMap.setBounds(deliveryZones.getBounds(), {
                checkZoomRange: true,
                zoomMargin: 20
            });

            // Добавление маркеров самовывоза с кастомным логотипом
            const pickups = [
                {
                    coords: [39.906872, 43.451884],
                    title: 'Адлер: ул. Голубые Дали, 58/3',
                    link: 'https://yandex.ru/profile/-/CLhp7KIY'
                },
                {
                    coords: [39.719636, 43.586577],
                    title: 'Сочи: ул. Воровского, 5',
                    link: 'https://yandex.ru/profile/-/CLhtAY1F'
                }
            ];

            const logoUrl = 'https://static.tildacdn.com/tild3939-3438-4066-b837-653234386331/noroot.png';

            pickups.forEach(p => {
                var placemark = new ymaps.Placemark(p.coords, {
                    hintContent: p.title,
                    balloonContent: `
                        <div style="padding: 10px; font-family: 'Inter', sans-serif;">
                            <img src="${logoUrl}" style="height: 30px; margin-bottom: 10px;">
                            <div style="font-weight: 700; font-size: 14px; margin-bottom: 5px;">${p.title}</div>
                            <a href="${p.link}" target="_blank" style="color: #ff7a00; text-decoration: none; font-size: 12px; font-weight: 600;">Открыть на картах →</a>
                        </div>
                    `
                }, {
                    iconLayout: 'default#image',
                    iconImageHref: logoUrl,
                    iconImageSize: [40, 40],
                    iconImageOffset: [-20, -20]
                });
                myMap.geoObjects.add(placemark);
            });

            // Стилизация зон
            deliveryZones.each(function (obj) {
                var props = obj.properties.getAll();
                obj.options.set({
                    fillColor: props.fill || '#ed4543',
                    fillOpacity: 0.3,
                    strokeColor: props.stroke || '#ed4543',
                    strokeWidth: 3,
                    strokeOpacity: 0.8
                });

                // Клик по зоне
                obj.events.add('click', function (e) {
                    showZoneInfo(props.description);
                    myMap.setCenter(e.get('coords'), myMap.getZoom(), { duration: 300 });
                });
            });

            // Поиск адреса
            document.getElementById('search-btn').onclick = function () {
                var address = document.getElementById('address-input').value;
                if (!address) return;

                ymaps.geocode(address).then(function (res) {
                    var firstGeoObject = res.geoObjects.get(0);
                    if (firstGeoObject) {
                        var coords = firstGeoObject.geometry.getCoordinates();
                        myMap.setCenter(coords, 14);

                        // Проверка попадания в зону
                        var result = deliveryZones.searchContain(coords).get(0);
                        if (result) {
                            showZoneInfo(result.properties.get('description'));
                        } else {
                            showZoneInfo("К сожалению, ваш адрес не входит в зону доставки.");
                        }
                    }
                });
            };

            // Интеграция DaData Suggestions
            $("#address-input").suggestions({
                token: "54696a8ca69a52075d99de0631095138b3d557a0",
                type: "ADDRESS",
                /* Ограничение поиска регионом Сочи */
                constraints: {
                    locations: { region: "Краснодарский", city: "Сочи" },
                },
                onSelect: function (suggestion) {
                    // При выборе из списка сразу запускаем поиск на карте
                    document.getElementById('search-btn').click();
                }
            });
        }

        function showZoneInfo(desc) {
            const infoBox = document.getElementById('active-zone-info');
            const details = document.getElementById('zone-details');

            // Парсинг цены и минималки из описания "Доставка 400р фиксированно\nМинимальная сумма заказа 1000р"
            const priceMatch = desc.match(/доставка\s+(\d+)/i);
            const minMatch = desc.match(/минимальная\s+сумма\s+заказа\s+(\d+)/i);

            const price = priceMatch ? priceMatch[1] : null;
            const min = minMatch ? minMatch[1] : null;

            let html = '';
            if (price) {
                html += `
                    <div class="price-badge">
                        <span class="price-value">${price} ₽</span>
                        <span class="price-label">Стоимость доставки</span>
                    </div>
                `;
            }
            if (min) {
                html += `
                    <div style="margin-top: 15px; font-size: 14px; text-align: center;">
                        <span style="color: var(--text-muted)">Минимум для заказа:</span> 
                        <span style="font-weight: 700">${min} ₽</span>
                    </div>
                `;
            }
            if (!price && !min) {
                html = `<p style="font-size: 14px; color: var(--primary); text-align: center;">${desc}</p>`;
            }

            details.innerHTML = html;
            infoBox.classList.add('visible');
        }
    </script>
</body>

</html>